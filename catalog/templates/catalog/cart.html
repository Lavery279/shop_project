{% extends "catalog/base.html" %}
{% block content %}
<div class="min-h-screen bg-background">
    <main class="pt-24 pb-16">
        <div class="container px-6">
            {% if cart %}
            <h1 class="font-display text-4xl md:text-5xl font-medium text-foreground mb-8 text-center">
                –ö–æ—à–∏–∫
            </h1>

            <div class="max-w-4xl mx-auto">
                <div class="grid lg:grid-cols-3 gap-8">
                    <!-- Cart Items -->
                    <div class="lg:col-span-2 space-y-4">
                        {% for item in cart %}
                        <div class="flex gap-4 p-4 bg-card border border-border rounded-lg">
                            <img src="{{ item.product.image }}" alt="{{ item.product.title }}"
                                class="w-24 h-24 object-cover rounded-md" />
                            <div class="flex-1">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <p class="font-body text-xs text-muted-foreground uppercase">
                                            {{ item.product.category.name }}
                                        </p>
                                        <h3 class="font-display text-lg text-foreground">
                                            {{ item.product.title }}
                                        </h3>
                                    </div>
                                    <form action="{% url 'remove_from_cart' item.product.id %}" method="post">
                                        {% csrf_token %}
                                        <button type="submit" class="p-1 hover:bg-secondary rounded transition-colors">
                                            ‚úï
                                        </button>
                                    </form>
                                </div>

                                <div class="flex items-center justify-between mt-4">
                                    <div class="flex items-center gap-2">
                                        <!-- –∫–Ω–æ–ø–∫–∞ "-" -->
                                        <form action="{% url 'update_cart' item.product.id %}" method="post">
                                            {% csrf_token %}
                                            <input type="hidden" name="quantity" value="{{ item.quantity|add:" -1" }}">
                                            <button type="submit"
                                                class="w-8 h-8 flex items-center justify-center border border-border rounded hover:bg-secondary transition-colors">
                                                ‚àí
                                            </button>
                                        </form>

                                        <!-- –∫—ñ–ª—å–∫—ñ—Å—Ç—å -->
                                        <span class="font-body w-8 text-center">{{ item.quantity }}</span>

                                        <!-- –∫–Ω–æ–ø–∫–∞ "+" -->
                                        <form action="{% url 'update_cart' item.product.id %}" method="post">
                                            {% csrf_token %}
                                            <input type="hidden" name="quantity" value="{{ item.quantity|add:" 1" }}">
                                            <button type="submit"
                                                class="w-8 h-8 flex items-center justify-center border border-border rounded hover:bg-secondary transition-colors">
                                                +
                                            </button>
                                        </form>
                                    </div>
                                    <p class="font-body font-medium text-foreground">
                                        {{ item.total }} ‚Ç¥
                                    </p>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>

                    <!-- Order Summary -->
                    <div class="lg:col-span-1">
                        <div class="bg-card p-6 border border-border rounded-lg sticky top-24">
                            <h2 class="font-display text-xl font-medium text-foreground mb-4">–†–∞–∑–æ–º</h2>

                            <div class="space-y-3 mb-6">
                                <div class="flex justify-between font-body text-sm">
                                    <span class="text-muted-foreground">–¢–æ–≤–∞—Ä–∏</span>
                                    <span>
                                        {% with total=0 %}
                                        {% for item in cart %}
                                        {% widthratio item.total 1 1 as subtotal %}
                                        {% with total=total|add:subtotal %}
                                        {% endwith %}
                                        {% endfor %}
                                        {{ total }} ‚Ç¥
                                        {% endwith %}
                                    </span>
                                </div>
                                <div class="flex justify-between font-body text-sm">
                                    <span class="text-muted-foreground">–î–æ—Å—Ç–∞–≤–∫–∞</span>
                                    <span>–ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ</span>
                                </div>
                                <div class="border-t border-border pt-3">
                                    <div class="flex justify-between font-body font-medium">
                                        <span>–î–æ —Å–ø–ª–∞—Ç–∏</span>
                                        <span class="text-primary">
                                            {{ total }} ‚Ç¥
                                        </span>
                                    </div>
                                </div>
                            </div>

                            <form action="{% url 'checkout' %}" method="get">
                                <button
                                    type="submit"
                                    class="w-full block text-center px-6 py-3 rounded-lg bg-amber-600 text-white font-body
                                                hover:bg-amber-700 hover:text-gray-100 transition">
                                        –û—Ñ–æ—Ä–º–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
                                </button>
                            </form>

                            <a href="{% url 'product_list' %}"
                                class="block text-center mt-4 font-body text-sm text-muted-foreground hover:text-foreground transition-colors">
                                –ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏ –ø–æ–∫—É–ø–∫–∏
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {% else %}
            <!-- Empty cart -->
            <div class="max-w-2xl mx-auto text-center py-16">
                <div class="w-16 h-16 mx-auto text-muted-foreground mb-6">üõçÔ∏è</div>
                <h1 class="font-display text-3xl font-medium text-foreground mb-4">–ö–æ—à–∏–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π</h1>
                <p class="font-body text-muted-foreground mb-8">
                    –î–æ–¥–∞–π—Ç–µ —Ç–æ–≤–∞—Ä–∏ –¥–æ –∫–æ—à–∏–∫–∞, —â–æ–± –æ—Ñ–æ—Ä–º–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
                </p>
                <a href="{% url 'product_list' %}"
                    class="px-6 py-3 rounded-lg bg-primary text-white font-medium hover:bg-primary/90 transition">
                    –ü–µ—Ä–µ–π—Ç–∏ –¥–æ –∫–∞—Ç–∞–ª–æ–≥—É
                </a>
            </div>
            {% endif %}
        </div>
    </main>
</div>
{% endblock %}
